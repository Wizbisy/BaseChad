<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chad NFT Mint Page</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body {background-color:#1e3a8a;color:#fff;display:flex;flex-direction:column;min-height:100vh;}
.header {display:flex;justify-content:space-between;align-items:center;padding:20px;background-color:#1e40af;}
.logo {cursor:pointer;}
.logo svg {width:120px;height:50px;}
.wallet-connect-header {background-color:#2563eb;padding:10px 20px;border-radius:5px;cursor:pointer;font-size:16px;}
.wallet-connect-header.connected::after {content:" (Connected)";color:#22c55e;}
.separator {border-bottom:2px solid #fff;margin:0 20px;}
.body {flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;text-align:center;}
.nft-image {width:300px;height:300px;background-color:#3b82f6;margin-bottom:20px;border-radius:10px;background-image:url('https://ipfs.io/ipfs/bafkreif3in6wmhvrcfi26fvojixolla4yhvegltbwvean4sldjju72obo4');background-size:cover;background-position:center;}
.nft-info {margin-bottom:20px;font-size:18px;font-family:'Courier New',Courier,monospace;letter-spacing:2px;text-transform:uppercase;background:linear-gradient(to right,#fff 50%,transparent 50%) 0 0/2px 2px;-webkit-text-fill-color:transparent;-webkit-background-clip:text;}
.action-button {padding:15px 30px;border:none;border-radius:5px;color:#fff;font-size:18px;font-family:'Courier New',Courier,monospace;letter-spacing:2px;text-transform:uppercase;cursor:pointer;transition:background-color 0.3s;}
.action-button.wallet-connect {background-color:#2563eb;}
.action-button.mint {background-color:#1d4ed8;}
.action-button:hover {filter:brightness(0.9);}
</style>
</head>
<body>
<div class="header">
    <div class="logo">
        <svg viewBox="0 0 120 50" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <pattern id="dots" x="0" y="0" width="3" height="3" patternUnits="userSpaceOnUse">
                    <rect x="0" y="0" width="1.5" height="1.5" fill="#ffffff" />
                </pattern>
            </defs>
            <text x="0" y="40" font-family="Courier New, Courier, monospace" font-size="40" fill="url(#dots)" text-transform="uppercase">Chad</text>
        </svg>
    </div>
    <div class="wallet-connect-header">Connect Wallet</div>
</div>
<div class="separator"></div>
<div class="body">
    <div class="nft-image"></div>
    <div class="nft-info">Total NFTs: Loading...</div>
    <div class="nft-info">NFTs Minted: Loading...</div>
    <div class="nft-info">Your NFTs Minted: Loading...</div>
    <button class="action-button wallet-connect">Connect Wallet</button>
</div>

<!-- Ethers.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>

<script type="module">
const backendUrl = 'https://hchad-nft-fullstack.vercel.app';

const walletHeader = document.querySelector('.wallet-connect-header');
const connectButton = document.querySelector('.action-button.wallet-connect');
const totalNftsInfo = document.querySelector('.nft-info:nth-of-type(1)');
const mintedNftsInfo = document.querySelector('.nft-info:nth-of-type(2)');
const yourMintedInfo = document.querySelector('.nft-info:nth-of-type(3)');

const mintButton = document.createElement('button');
mintButton.className = 'action-button mint';
mintButton.textContent = 'Mint NFT';
mintButton.style.display = 'none';
connectButton.parentNode.insertBefore(mintButton, connectButton.nextSibling);

let provider, signer, userAddress;

// Shorten address
function shortenAddress(addr) {
    return addr ? `${addr.slice(0,6)}...${addr.slice(-4)}` : '';
}

// Update contract info
async function updateInfo() {
    try {
        const data = await fetch(`${backendUrl}/contract-data${userAddress ? `?address=${userAddress}` : ''}`).then(res => res.json());
        totalNftsInfo.textContent = `Total NFTs: ${data.maxSupply}`;
        mintedNftsInfo.textContent = `NFTs Minted: ${data.totalMinted}`;
        yourMintedInfo.textContent = `Your NFTs Minted: ${data.yourMinted}`;
    } catch (err) {
        console.error('Update info error:', err);
    }
}

// Connect wallet
async function connectWallet() {
    if (!window.ethereum) return alert('Please install MetaMask/Base Wallet');

    provider = new ethers.BrowserProvider(window.ethereum, 'any');
    await provider.send("eth_requestAccounts", []);
    signer = await provider.getSigner();
    userAddress = await signer.getAddress();

    walletHeader.textContent = shortenAddress(userAddress);
    walletHeader.classList.add('connected');
    connectButton.style.display = 'none';
    mintButton.style.display = 'block';

    updateInfo();
}

// Mint NFT
async function mintNFT() {
    try {
        const contractAddress = '0x33865EB37644bBCDb106b5f572FF4C4bE2B2B3DF';
        const abi = [{"inputs":[{"internalType":"string","name":"initialBaseURI","type":"string"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"uint256","name":"numerator","type":"uint256"},{"internalType":"uint256","name":"denominator","type":"uint256"}],"name":"ERC2981InvalidDefaultRoyalty","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC2981InvalidDefaultRoyaltyReceiver","type":"error"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"numerator","type":"uint256"},{"internalType":"uint256","name":"denominator","type":"uint256"}],"name":"ERC2981InvalidTokenRoyalty","type":"error"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC2981InvalidTokenRoyaltyReceiver","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"owner","type":"address"}],"name":"ERC721IncorrectOwner","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ERC721InsufficientApproval","type":"error"},{"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC721InvalidApprover","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"}],"name":"ERC721InvalidOperator","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"ERC721InvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC721InvalidReceiver","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC721InvalidSender","type":"error"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ERC721NonexistentToken","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[],"name":"MAX_PER_WALLET","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"mint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"mintedPerWallet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"ownerMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"price","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"salePrice","type":"uint256"}],"name":"royaltyInfo","outputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"newBaseURI","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newPrice","type":"uint256"}],"name":"setPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalMinted","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"to","type":"address"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}]
        const contract = new ethers.Contract(contractAddress, abi, signer);
        const price = await contract.price();
        const tx = await contract.mint({ value: price });
        await tx.wait();
        console.log('Minted!', tx.hash);
        updateInfo();
    } catch(err) {
        console.error('Mint error:', err);
    }
}

// Event listeners
walletHeader.addEventListener('click', () => {
    if(!userAddress) connectWallet();
});
connectButton.addEventListener('click', connectWallet);
mintButton.addEventListener('click', mintNFT);

// Initial load
updateInfo();
</script>
</body>
</html>
